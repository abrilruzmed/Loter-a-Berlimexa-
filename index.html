<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Loter√≠a Berlimexa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fuente divertida -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;800&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, sans-serif;
      background: #f5f0ea;
      color: #333;
    }

    /* HEADER */
    .header {
      text-align: center;
      padding: 1.5rem 1rem;
      background: #c62828;
      color: #fff;
      overflow: hidden;
      position: relative;
    }

    .header h1 {
      font-family: "Baloo 2", sans-serif;
      font-size: 2.5rem;
      margin-bottom: 0.3rem;
    }

    .header p {
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }

    /* MARQUEE */
    .marquee {
      margin-top: 0.5rem;
      border-top: 1px solid rgba(255,255,255,0.4);
      border-bottom: 1px solid rgba(255,255,255,0.4);
      overflow: hidden;
      padding: 0.5rem 0;
      height: 80px;
    }

    .marquee-inner {
      display: flex;
      gap: 0.5rem;
      animation: scroll 18s linear infinite;
    }

    .marquee-card {
      width: 55px;
      height: 75px;
      background-size: cover;
      background-position: center;
      border-radius: 6px;
      flex: 0 0 auto;
      box-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }

    @keyframes scroll {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* LAYOUT GENERAL */
    .container {
      display: flex;
      padding: 1rem;
      gap: 1rem;
      flex-wrap: wrap;
    }

    /* PANEL IZQUIERDO */
    .panel {
      flex: 0 0 260px;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .current-card {
      width: 130px;
      height: 190px;
      margin: 0.5rem auto;
      border-radius: 8px;
      border: 2px solid #222;
      background: #eee center/cover no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
    }

    .controls button {
      width: 48%;
      margin: 0.2rem 1%;
      padding: 0.4rem;
      border: none;
      border-radius: 5px;
      background: #1565c0;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }

    .controls button:disabled {
      background: #aaa;
    }

    .log-messages {
      height: 130px;
      overflow-y: auto;
      padding: 0.5rem;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    /* TABLERO JUGADOR */
    .board-section {
      flex: 1 1 280px;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #player-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.35rem;
      max-width: 300px;
      margin: auto;
    }

    .board-cell {
      position: relative;
      padding-top: 120%;
      border-radius: 6px;
      border: 2px solid #333;
      background-size: cover;
      background-position: center;
      cursor: pointer;
    }

    .board-cell::after {
      content: attr(data-card-id);
      position: absolute;
      bottom: 3px;
      width: 100%;
      text-align: center;
      font-weight: 700;
      font-size: 0.8rem;
      color: white;
      text-shadow: 0 0 3px black;
    }

    .board-cell.marked {
      filter: brightness(0.65);
      outline: 4px solid yellow;
    }

    /* OPONENTES */
    .opponents-section {
      flex: 1 1 260px;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .opponent-card {
      background: #fafafa;
      padding: 0.6rem;
      border-radius: 8px;
      margin-bottom: 0.8rem;
    }

    .opponent-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.25rem;
    }

    .opponent-board .board-cell {
      padding-top: 110%;
      cursor: default;
    }

    /* FOOTER */
    .footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.8rem;
      color: #444;
    }
  </style>
</head>

<body>
  <header class="header">
    <h1>Loter√≠a Berlimexa</h1>
    <p>Creado por Abril Ruzmed</p>
    <p>Prototipo recreativo ¬∑ Sin apuestas ¬∑ Sin premios monetarios ¬∑ Inspirado en la loter√≠a mexicana</p>

    <div class="marquee">
      <div class="marquee-inner" id="marquee-inner"></div>
    </div>
  </header>

  <main class="container">
    <!-- PANEL IZQUIERDO -->
    <section class="panel">
      <h2>Partida</h2>

      <p><strong>Carta actual:</strong></p>
      <div id="current-card" class="current-card">
        <span id="current-card-number">‚Äì</span>
      </div>

      <p id="cards-played">Cartas jugadas: 0 / 54</p>

      <div class="controls">
        <button id="btn-new-game">Nueva</button>
        <button id="btn-pause" disabled>Pausar</button>
        <button id="btn-resume" disabled>Reanudar</button>
        <button id="btn-loteria" disabled>¬°Loter√≠a!</button>
      </div>

      <h3>Jugadores</h3>
      <ul>
        <li>Panda: <span id="bot1-progress">0 / 16</span></li>
        <li>Cleo: <span id="bot2-progress">0 / 16</span></li>
        <li>July: <span id="bot3-progress">0 / 16</span></li>
      </ul>

      <h3>Mensajes</h3>
      <div id="log-messages" class="log-messages"></div>
    </section>

    <!-- TABLERO JUGADOR -->
    <section class="board-section">
      <h2>Tu tablero (4√ó4)</h2>
      <p>Haz clic en tus cartas cuando salgan. No se resaltan autom√°ticamente.</p>

      <div id="player-board"></div>
    </section>

    <!-- OPONENTES -->
    <section class="opponents-section">
      <h2>Oponentes</h2>

      <div class="opponent-card">
        <h3>Panda</h3>
        <div id="board-panda" class="opponent-board"></div>
      </div>

      <div class="opponent-card">
        <h3>Cleo</h3>
        <div id="board-cleo" class="opponent-board"></div>
      </div>

      <div class="opponent-card">
        <h3>July</h3>
        <div id="board-july" class="opponent-board"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    Loter√≠a Berlimexa ¬∑ Prototipo sin √°nimo de lucro ¬∑ 2025 ¬∑ All rights reserved.
  </footer>

<script>
  /* CONFIG */
  const TOTAL_CARDS = 54;
  const BOARD_SIZE = 16;
  const CARD_INTERVAL = 4000;
  const CARD_BASE_URL = "assets";

  let deck = [];
  let currentCardIndex = -1;
  let interval = null;
  let paused = false;
  let gameOver = false;

  let playerBoard = [];
  let playerMarked = new Set();

  const bots = [
    { name: "Panda", board: [], marked: new Set(), el: null, prog: null },
    { name: "Cleo", board: [], marked: new Set(), el: null, prog: null },
    { name: "July", board: [], marked: new Set(), el: null, prog: null }
  ];

  const marqueeInner = document.getElementById("marquee-inner");

  function shuffle(arr) {
    let a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function createDeck() {
    return shuffle([...Array(TOTAL_CARDS).keys()].map(i => i + 1));
  }

  function generateBoard() {
    return createDeck().slice(0, BOARD_SIZE);
  }

  function log(msg) {
    const box = document.getElementById("log-messages");
    const line = document.createElement("div");
    line.textContent = msg;
    box.appendChild(line);
    box.scrollTop = box.scrollHeight;
  }

  /* MARQUEE */
  function initMarquee() {
    const cards = [1,2,3,4,5,6,7,8];
    const loop = cards.concat(cards);

    loop.forEach(id => {
      const d = document.createElement("div");
      d.className = "marquee-card";
      d.style.backgroundImage = `url("${CARD_BASE_URL}/${id}.png")`;
      marqueeInner.appendChild(d);
    });
  }

  /* RENDER TABLEROS */
  function renderPlayerBoard() {
    const board = document.getElementById("player-board");
    board.innerHTML = "";
    playerBoard.forEach(card => {
      const c = document.createElement("div");
      c.className = "board-cell";
      c.dataset.cardId = card;
      c.style.backgroundImage = `url("${CARD_BASE_URL}/${card}.png")`;

      c.onclick = () => onPlayerClick(c);
      board.appendChild(c);
    });
  }

  function renderBots() {
    bots.forEach(bot => {
      bot.el.innerHTML = "";
      bot.board.forEach(card => {
        const c = document.createElement("div");
        c.className = "board-cell";
        c.dataset.cardId = card;
        c.style.backgroundImage = `url("${CARD_BASE_URL}/${card}.png")`;
        bot.el.appendChild(c);
      });
    });
  }

  function updateBotProgress() {
    bots.forEach(bot => {
      bot.prog.textContent = `${bot.marked.size} / 16`;
    });
  }

  function markBotCardUi(bot, card) {
    [...bot.el.querySelectorAll(".board-cell")].forEach(cell => {
      if (Number(cell.dataset.cardId) === card) {
        cell.classList.add("marked");
      }
    });
  }

  /* CLICK USUARIO */
  function onPlayerClick(cell) {
    if (gameOver || currentCardIndex < 0) return;

    const id = Number(cell.dataset.cardId);
    const revealed = new Set(deck.slice(0, currentCardIndex + 1));

    if (!revealed.has(id)) {
      log("Esa carta a√∫n no ha salido.");
      return;
    }

    if (playerMarked.has(id)) {
      playerMarked.delete(id);
      cell.classList.remove("marked");
    } else {
      playerMarked.add(id);
      cell.classList.add("marked");
    }
  }

  /* BOTS */
  function botsProcess(card) {
    bots.forEach(bot => {
      if (bot.board.includes(card) && !bot.marked.has(card)) {
        bot.marked.add(card);
        markBotCardUi(bot, card);
      }

      if (!gameOver && bot.marked.size === 16) {
        gameOver = true;
        stopDealer();
        updateBotProgress();
        log(`${bot.name} grita ¬°LOTER√çA!`);
        alert(`${bot.name} ha ganado.`);
      }
    });

    updateBotProgress();
  }

  /* CARTAS */
  function updateCardUi() {
    const currentEl = document.getElementById("current-card");
    const numberEl = document.getElementById("current-card-number");

    if (currentCardIndex < 0) {
      numberEl.textContent = "‚Äì";
      currentEl.style.backgroundImage = "none";
      return;
    }

    const card = deck[currentCardIndex];
    numberEl.textContent = card;
    currentEl.style.backgroundImage = `url("${CARD_BASE_URL}/${card}.png")`;
    document.getElementById("cards-played").textContent =
      `Cartas jugadas: ${currentCardIndex + 1} / 54`;
  }

  function nextCard() {
    if (paused || gameOver) return;

    currentCardIndex++;
    if (currentCardIndex >= deck.length) {
      stopDealer();
      log("Se acabaron las cartas.");
      alert("Nadie gan√≥.");
      return;
    }

    const card = deck[currentCardIndex];
    updateCardUi();
    log(`Sali√≥ la carta ${card}`);
    botsProcess(card);
  }

  function startDealer() {
    stopDealer();
    interval = setInterval(nextCard, CARD_INTERVAL);
  }

  function stopDealer() {
    if (interval) clearInterval(interval);
    interval = null;
  }

  /* JUEGO */
  function resetGame() {
    stopDealer();
    deck = createDeck();
    currentCardIndex = -1;
    paused = false;
    gameOver = false;

    playerBoard = generateBoard();
    playerMarked.clear();

    bots[0].board = generateBoard();
    bots[1].board = generateBoard();
    bots[2].board = generateBoard();

    renderPlayerBoard();
    renderBots();
    updateBotProgress();
    updateCardUi();

    document.getElementById("log-messages").innerHTML = "";
    log("Nueva partida.");
  }

  function startGame() {
    resetGame();
    document.getElementById("btn-pause").disabled = false;
    document.getElementById("btn-loteria").disabled = false;

    startDealer();
    nextCard();
  }

  function pauseGame() {
    paused = true;
    stopDealer();
    document.getElementById("btn-pause").disabled = true;
    document.getElementById("btn-resume").disabled = false;
    log("Pausa.");
  }

  function resumeGame() {
    paused = false;
    document.getElementById("btn-pause").disabled = false;
    document.getElementById("btn-resume").disabled = true;
    startDealer();
    log("Reanudar.");
  }

  function checkLoteria() {
    if (gameOver) return;
    const revealed = new Set(deck.slice(0, currentCardIndex + 1));

    const allMarked = playerBoard.every(id => playerMarked.has(id));
    const allRevealed = playerBoard.every(id => revealed.has(id));

    if (allMarked && allRevealed) {
      gameOver = true;
      stopDealer();
      log("LOTER√çA v√°lida.");
      alert("Ganaste ü•≥");
    } else {
      log("Loter√≠a falsa.");
      alert("Loter√≠a falsa.");
    }
  }

  /* EVENTOS */
  document.getElementById("btn-new-game").onclick = startGame;
  document.getElementById("btn-pause").onclick = pauseGame;
  document.getElementById("btn-resume").onclick = resumeGame;
  document.getElementById("btn-loteria").onclick = checkLoteria;

  /* INICIO */
  bots[0].el = document.getElementById("board-panda");
  bots[1].el = document.getElementById("board-cleo");
  bots[2].el = document.getElementById("board-july");

  bots[0].prog = document.getElementById("bot1-progress");
  bots[1].prog = document.getElementById("bot2-progress");
  bots[2].prog = document.getElementById("bot3-progress");

  initMarquee();
  resetGame();

</script>

</body>
</html>
